<!doctype html>
</div>
<div class="flex items-center gap-2">
<button class="px-2 py-1 rounded border" data-act="dec" data-id="${i.id}">âˆ’</button>
<button class="px-2 py-1 rounded border" data-act="inc" data-id="${i.id}">+</button>
<button class="px-2 py-1 rounded border" data-act="del" data-id="${i.id}">ğŸ—‘</button>
</div>
</div>
`).join('') || `<div class="p-6 text-center text-slate-500">Tu carrito estÃ¡ vacÃ­o</div>`;


cartItems.querySelectorAll('button').forEach(b=>{
b.onclick = ()=>{
const id = b.dataset.id; const act = b.dataset.act;
const item = cart.find(x=>x.id===id);
if(!item) return;
if(act==='inc') item.qty++;
if(act==='dec') item.qty = Math.max(1, item.qty-1);
if(act==='del') cart = cart.filter(x=>x.id!==id);
saveCart(); updateCartUI();
}
});


updateWhatsappLinks();
}


function buildWhatsappMessage(){
if(!cart.length) return `${STORE.name}: Hola!`;
const lines = [
`Hola! Quiero hacer un pedido en *${STORE.name}* (PapelerÃ­a):
`,
...cart.map(i=>`â€¢ ${i.title} Ã— ${i.qty} â€” ${fmt(i.price*i.qty)}`),
`
Total: ${fmt(cart.reduce((s,i)=>s+i.price*i.qty,0))}`,
`
Comuna/RegiÃ³n:`,
`
MÃ©todo de pago (transferencia/efectivo):`
];
return encodeURIComponent(lines.join('
'));
}


const btnWhatsappTop = document.getElementById('btnWhatsappTop');
const btnWhatsappCart = document.getElementById('btnWhatsappCart');


function updateWhatsappLinks(){
const url = `https://wa.me/${STORE.whatsappNumber}?text=${buildWhatsappMessage()}`;
if(btnWhatsappTop) btnWhatsappTop.href = url;
if(btnWhatsappCart) btnWhatsappCart.onclick = ()=> window.open(url,'_blank');
}


// Eventos
document.querySelectorAll('input[name="precio"]').forEach(r=> r.addEventListener('change', render));
document.querySelectorAll('.tipo').forEach(c=> c.addEventListener('change', render));
if(inputSearch) inputSearch.addEventListener('input', render);
if(sortSel) sortSel.addEventListener('input', render);


// Init
document.getElementById('year').textContent = new Date().getFullYear();
render(); updateCartUI(); updateWhatsappLinks();
</script>
</body>
</html>
